diff --git a/src/isomedia/isom_write.c b/src/isomedia/isom_write.c
--- a/src/isomedia/isom_write.c
+++ b/src/isomedia/isom_write.c
@@ -3395,7 +3395,7 @@
 	//fill the table. Although it seems weird , this is needed in case of edition
 	//after the function is called. NOte however than we force regular table
 	//at write time if all samples are of same size
-	if (stsz->sampleSize) {
+	if (stsz->sampleSize && stsz->sampleCount) {
 		//this is a weird table indeed ;)
 		if (stsz->sizes) gf_free(stsz->sizes);
 		stsz->sizes = (u32*) gf_malloc(sizeof(u32)*stsz->sampleCount);