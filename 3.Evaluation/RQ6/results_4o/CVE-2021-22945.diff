diff --git a/lib/mqtt.c b/lib/mqtt.c
--- a/lib/mqtt.c
+++ b/lib/mqtt.c
@@ -128,6 +128,10 @@
     mq->sendleftovers = sendleftovers;
     mq->nsend = nsend;
   }
+  else {
+    mq->sendleftovers = NULL;
+    mq->nsend = 0;
+  }
   return result;
 }
 
This patch addresses the use-after-free vulnerability by ensuring the `sendleftovers` pointer and `nsend` counter are properly reset to NULL/0 when no data remains, preventing dangling pointer reuse and double-free scenarios.