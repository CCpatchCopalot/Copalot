diff --git a/libfreerdp/codec/h264.c b/libfreerdp/codec/h264.c
--- a/libfreerdp/codec/h264.c
+++ b/libfreerdp/codec/h264.c
@@ -55,6 +55,11 @@
 	if (pheight % 16 != 0)
 		pheight += 16 - pheight % 16;
 
+	if (pheight == 0)
+		return FALSE;
+	if (stride == 0)
+		return FALSE;
+
 	for (x = 0; x < 3; x++)
 	{
 		if (!h264->pYUVData[x] || !h264->pOldYUVData[x])
@@ -420,6 +425,9 @@
 	{
 		for (UINT32 x = 0; x < 3; x++)
 		{
+			if (piDstSize[x] == 0)
+				return FALSE;
+
 			piDstStride[x] = piMainStride[0];
 			piDstSize[x] = piDstStride[x] * padDstHeight;
 			tmp1 = winpr_aligned_recalloc(ppYUVDstData[x], piDstSize[x], 1, 16);