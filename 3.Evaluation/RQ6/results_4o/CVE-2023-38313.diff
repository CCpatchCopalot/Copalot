diff --git a/src/http_microhttpd.c b/src/http_microhttpd.c
--- a/src/http_microhttpd.c
+++ b/src/http_microhttpd.c
@@ -613,6 +613,9 @@ static int authenticate_client(struct MHD_Connection *connection,
 	// get custom string
 	custom = MHD_lookup_connection_value(connection, MHD_GET_ARGUMENT_KIND, "custom");
 
+	if (!custom || strlen(custom) == 0) {
+		custom="bmE=";
+	}
 
 	if (config->binauth) {
 		rc = do_binauth(
@@ -1216,6 +1219,10 @@ static int preauthenticated(struct MHD_Connection *connection, const char *url,
 		redirect_url = safe_calloc(REDIRECT_URL);
 		redirect_url = get_redirect_url(connection);
 
+		if (redirect_url == NULL) {
+			return send_error(connection, 403);
+		}
+
 		if (!try_to_authenticate(connection, client, host, url)) {
 			// user used an invalid token, redirect to splashpage but hold query "redir" intact
 			originurl = safe_calloc(REDIRECT_URL_ENC_BUF);
