diff --git a/src/sp/protocol/mqtt/mqtt_parser.c b/src/sp/protocol/mqtt/mqtt_parser.c
--- a/src/sp/protocol/mqtt/mqtt_parser.c
+++ b/src/sp/protocol/mqtt/mqtt_parser.c
@@ -613,6 +613,9 @@
 	// properties
 	if (cparam->pro_ver == MQTT_PROTOCOL_VERSION_v5) {
 		log_trace("MQTT V5 Properties");
+		cparam->prop_len = (uint32_t) get_var_integer(packet + pos, &len_of_var);
+		if (cparam->prop_len > (max - pos - 1 - cparam->will_flag*2 ))
+			return PROTOCOL_ERROR;
 		cparam->properties = decode_buf_properties(
 		    packet, len, &pos, &cparam->prop_len, true);
 		if (cparam->properties) {