diff --git a/libmariadb/mariadb_lib.c b/libmariadb/mariadb_lib.c
--- a/libmariadb/mariadb_lib.c
+++ b/libmariadb/mariadb_lib.c
@@ -2240,7 +2240,7 @@
                 str->str= data;
                 memcpy(str->str, (char *)pos, plen);
                 pos+= plen;
                 session_item->data= str;
-                if (set_charset && str->length < CHARSET_NAME_LEN &&
+                if (set_charset &&
                     strncmp(mysql->charset->csname, str->str, str->length) != 0)
                 {
                   char cs_name[CHARSET_NAME_LEN];
