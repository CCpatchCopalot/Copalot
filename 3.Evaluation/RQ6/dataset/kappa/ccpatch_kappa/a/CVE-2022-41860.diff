diff --git a/src/modules/rlm_eap/libeap/eapsimlib.c b/src/modules/rlm_eap/libeap/eapsimlib.c
--- a/src/modules/rlm_eap/libeap/eapsimlib.c
+++ b/src/modules/rlm_eap/libeap/eapsimlib.c
@@ -334,6 +334,19 @@
 		}
 
 		newvp = fr_pair_afrom_num(r, eapsim_attribute + PW_EAP_SIM_BASE, 0);
+		if (!newvp) {
+			/*
+			 *	RFC 4186 Section 8.1 says 0..127 are "non-skippable".
+			 *	If we don't recognize a mandatory attribute, fail.
+			 */
+			if (eapsim_attribute <= 127) {
+				fr_strerror_printf("Unknown mandatory attribute %d, failing",
+						   eapsim_attribute);
+				return 0;
+			}
+			continue;
+		}
+
 		newvp->vp_length = eapsim_len - 2;
 
 		newvp->vp_octets = p = talloc_array(newvp, uint8_t, newvp->vp_length);
