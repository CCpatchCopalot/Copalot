diff --git a/src/http_microhttpd.c b/src/http_microhttpd.c
--- a/src/http_microhttpd.c
+++ b/src/http_microhttpd.c
@@ -522,6 +522,11 @@
 
 	// Check for authdir
 	if (check_authdir_match(url, config->authdir)) {
 		tok = MHD_lookup_connection_value(connection, MHD_GET_ARGUMENT_KIND, "tok");
+
+		if (tok == NULL) {
+			return send_error(connection, 403);
+		}
+
 		debug(LOG_DEBUG, "client->token=%s tok=%s ", client->token, tok );
 
 		//Check if token (tok) or hash_id (hid) mode
@@ -613,6 +618,7 @@
 	// get custom string
 	custom = MHD_lookup_connection_value(connection, MHD_GET_ARGUMENT_KIND, "custom");
 
+
 	if (config->binauth) {
 		rc = do_binauth(
 			client,
@@ -1216,6 +1222,10 @@
 		redirect_url = safe_calloc(REDIRECT_URL);
 		redirect_url = get_redirect_url(connection);
 
+		if (redirect_url == NULL) {
+			return send_error(connection, 403);
+		}
+
 		if (!try_to_authenticate(connection, client, host, url)) {
 			// user used an invalid token, redirect to splashpage but hold query "redir" intact
 			originurl = safe_calloc(REDIRECT_URL_ENC_BUF);
