diff --git a/src/sp/protocol/mqtt/mqtt_parser.c b/src/sp/protocol/mqtt/mqtt_parser.c
index 12188c6..acccef4 100644
--- a/src/sp/protocol/mqtt/mqtt_parser.c
+++ b/src/sp/protocol/mqtt/mqtt_parser.c
@@ -611,8 +611,12 @@ conn_handler(uint8_t *packet, conn_param *cparam, size_t max)
 	cparam->keepalive_mqtt = tmp;
 	pos += 2;
 	// properties
+
 	if (cparam->pro_ver == MQTT_PROTOCOL_VERSION_v5) {
+		// check length
 		log_trace("MQTT V5 Properties");
+		cparam->prop_len = (uint32_t) get_var_integer(packet + pos, &len_of_var);
+		if (cparam->prop_len > (max - pos - 1 - cparam->will_flag*2 )) return PROTOCOL_ERROR;
 		cparam->properties = decode_buf_properties(
 		    packet, len, &pos, &cparam->prop_len, true);
 		if (cparam->properties) {
