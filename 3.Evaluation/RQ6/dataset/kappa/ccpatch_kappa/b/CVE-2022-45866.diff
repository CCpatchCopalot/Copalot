diff --git a/qpress.cpp b/qpress.cpp
--- a/qpress.cpp
+++ b/qpress.cpp
@@ -183,7 +183,7 @@
 unsigned long long recovery_file_written;
 unsigned long long recovery_bad_bytes = 0;
 unsigned long long current_file_payload;
-char tmp[200000];
+char tmp[NAME_BUFFER_SIZE];
 
 enum {FATAL_ERROR, COUNTER_UPDATE, FILES_PROCESSED, RESULT, WARNING};
 
@@ -935,6 +935,21 @@
 	}
 }
 
+bool check_if_path_has_dir_traversal(char * new_path)
+{
+    bool ret_val = false;
+    char *found_template1 = NULL;
+	found_template1 = strstr (new_path,"../");
+	#ifdef WINDOWS 
+	    char *found_template2 = NULL;
+	    found_template2 = strstr (new_path,"..\\");
+	    ret_val = (found_template1 !=  NULL) || (found_template2 != NULL);
+	#else
+	    ret_val = found_template1 !=  NULL;
+	#endif
+    
+    return ret_val;
+}
 
 void decompress_directory(string extract_dir, bool std_out)
 {
@@ -955,6 +970,13 @@
         {
 			// read directory name, append it to current path and create the directory
             chunk_size = fread32();
+            try_aread(tmp, chunk_size + 1);
+            curdir = curdir + DELIM_STR + tmp;
+            PRINT(FILES_PROCESSED, "%s%s%s\n", BLANK_LINE, remove_leading_curdir(curdir).c_str(), DELIM_STR);
+			/* RDS security fix: https://rds-jira.amazon.com/browse/MMCP-231
+				Need to check if we try to decompress file or directory outside working directory
+			*/
+	        if(true == check_if_path_has_dir_traversal(tmp)) 
             {
                 abort("Directory path contains directory traversal which is not allowed.");
             }
@@ -972,7 +994,14 @@
         else if(c == 'F')
         {
             chunk_size = fread32(); // read length of file name
-            try_aread(tmp, chunk_size + 1); // read file name
+            try_aread(tmp, chunk_size + 1); // read file name to 'tmp' with size 'chunk_size + 1'
+			/* RDS security fix: https://rds-jira.amazon.com/browse/MMCP-231
+				Need to check if we try to decompress file or directory outside working directory
+			*/
+	         if(true == check_if_path_has_dir_traversal(tmp)) 
+	         {
+	             abort("File path contains directory traversal which is not allowed.");
+	         }
             string buf2 = curdir + DELIM_STR + tmp;
             PRINT(FILES_PROCESSED, "%s    %s\n", BLANK_LINE, tmp);
             if(!std_out)
