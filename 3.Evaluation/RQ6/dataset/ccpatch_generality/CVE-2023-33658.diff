diff --git a/src/mqtt/transport/tls/mqtt_tls.c b/src/mqtt/transport/tls/mqtt_tls.c
--- a/src/mqtt/transport/tls/mqtt_tls.c
+++ b/src/mqtt/transport/tls/mqtt_tls.c
@@ -699,7 +699,10 @@
 		} else if (qos_pac == 2) {
 			ack_cmd = CMD_PUBREC;
 		}
-		packet_id = nni_msg_get_pub_pid(msg);
+		if ((packet_id = nni_msg_get_pub_pid(msg)) == 0) {
+			rv = PROTOCOL_ERROR;
+			goto recv_error;
+		}
 		ack = true;
 	}
diff --git a/src/sp/transport/mqtts/broker_tls.c b/src/sp/transport/mqtts/broker_tls.c
--- a/src/sp/transport/mqtts/broker_tls.c
+++ b/src/sp/transport/mqtts/broker_tls.c
@@ -725,7 +725,10 @@
 		} else if (qos_pac == 2) {
 			ack_cmd = CMD_PUBREC;
 		}
-		packet_id = nni_msg_get_pub_pid(msg);
+		if ((packet_id = nni_msg_get_pub_pid(msg)) == 0) {
+			rv = PROTOCOL_ERROR;
+			goto recv_error;
+		}
 		ack       = true;
 	}
diff --git a/src/sp/transport/mqttws/nmq_websocket.c b/src/sp/transport/mqttws/nmq_websocket.c
--- a/src/sp/transport/mqttws/nmq_websocket.c
+++ b/src/sp/transport/mqttws/nmq_websocket.c
@@ -255,7 +255,10 @@
 			} else if (qos_pac == 2) {
 				ack_cmd = CMD_PUBREC;
 			}
-			packet_id = nni_msg_get_pub_pid(smsg);
+			if ((packet_id = nni_msg_get_pub_pid(smsg)) == 0) {
+				rv = PROTOCOL_ERROR;
+				goto recv_error;
+			}
 			ack       = true;
 		}
 	} else if (cmd == CMD_PUBREC) {
