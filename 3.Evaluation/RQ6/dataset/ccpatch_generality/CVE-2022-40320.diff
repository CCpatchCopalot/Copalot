diff --git a/src/confuse.c b/src/confuse.c
--- a/src/confuse.c
+++ b/src/confuse.c
@@ -1902,14 +1902,15 @@
 			file = strchr(filename, '/');
 			if (file == NULL)
 				file = filename + strlen(filename);
 
-			user = malloc(file - filename);
+			size_t len = file - filename - 1;
+			user = malloc(len + 1);
 			if (!user)
 				return NULL;
 
-			strncpy(user, filename + 1, file - filename - 1);
+			strncpy(user, filename + 1, len);
+			user[len] = 0;
 			passwd = getpwnam(user);
 			free(user);
-		}
 		}
 
 		if (passwd) {
