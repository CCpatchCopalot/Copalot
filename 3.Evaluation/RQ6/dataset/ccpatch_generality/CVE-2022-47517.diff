diff --git a/libsofia-sip-ua/url/url.c b/libsofia-sip-ua/url/url.c
--- a/libsofia-sip-ua/url/url.c
+++ b/libsofia-sip-ua/url/url.c
@@ -364,8 +364,12 @@
       continue;
     }
 
-    if (i >= strlen(s) - 1) return NULL;
-    h1 = s[i + 1], h2 = s[i + 2];
+    h1 = s[i + 1];
+    if (!h1) {
+        *d = '\0';
+        return NULL;
+    }
+    h2 = s[i + 2];
 
     if (!IS_HEX(h1) || !IS_HEX(h2)) {
       *d = '\0';
