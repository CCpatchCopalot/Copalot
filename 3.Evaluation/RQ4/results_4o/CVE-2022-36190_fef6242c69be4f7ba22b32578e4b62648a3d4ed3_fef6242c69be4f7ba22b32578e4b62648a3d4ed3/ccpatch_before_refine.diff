

The provided patch modifies the structure definitions of `GF_MPEGVisualSampleEntryBox` and `GF_MPEGAudioSampleEntryBox` to include fields previously in their "generic" counterparts, consolidating memory management. This structural unification likely resolves the use-after-free in `gf_isom_dovi_config_get` by ensuring `data` pointers are correctly retained or freed with their parent struct. Here's the relevant diff:

```diff
diff --git a/include/gpac/internal/isomedia_dev.h b/include/gpac/internal/isomedia_dev.h
index 8b62f9e94..df6262594 100644
--- a/include/gpac/internal/isomedia_dev.h
+++ b/include/gpac/internal/isomedia_dev.h
@@ -1522,7 +1522,7 @@ typedef struct
 	GF_ColourInformationBox *colr;
 } GF_J2KHeaderBox;
 
-typedef struct
+typedef struct __full_video_sample_entry
 {
 	GF_ISOM_VISUAL_SAMPLE_ENTRY
 	GF_ESDBox *esd;
@@ -1556,6 +1556,14 @@ typedef struct
 	/*iPod's hack*/
 	GF_UnknownUUIDBox *ipod_ext;
 
+	//for generic video sample entry
+
+	//box type as specified in the file (not this box's type!!)
+	u32 EntryType;
+	//opaque description data (ESDS in MP4, SMI in SVQ3, ...)
+	u8 *data;
+	u32 data_size;
+
 } GF_MPEGVisualSampleEntryBox;
 
 static const u8 GF_ISOM_IPOD_EXT[][16] = { { 0x6B, 0x68, 0x40, 0xF2, 0x5F, 0x24, 0x4F, 0xC5, 0xBA, 0x39, 0xA5, 0x1B, 0xCF, 0x03, 0x23, 0xF3} };
@@ -1563,16 +1571,7 @@ static const u8 GF_ISOM_IPOD_EXT[][16] = { { 0x6B, 0x68, 0x40, 0xF2, 0x5F, 0x24,
 Bool gf_isom_is_nalu_based_entry(GF_MediaBox *mdia, GF_SampleEntryBox *_entry);
 GF_Err gf_isom_nalu_sample_rewrite(GF_MediaBox *mdia, GF_ISOSample *sample, u32 sampleNumber, GF_MPEGVisualSampleEntryBox *entry);
 
-/*this is the default visual sdst (to handle unknown media)*/
-typedef struct
-{
-	GF_ISOM_VISUAL_SAMPLE_ENTRY
-	/*box type as specified in the file (not this box's type!!)*/
-	u32 EntryType;
-	/*opaque description data (ESDS in MP4, SMI in SVQ3, ...)*/
-	u8 *data;
-	u32 data_size;
-} GF_GenericVisualSampleEntryBox;
+typedef struct __full_video_sample_entry GF_GenericVisualSampleEntryBox;
 
 enum
 {
@@ -1702,7 +1701,7 @@ typedef struct
 } GF_PCMConfigBox;
 
 
-typedef struct
+typedef struct __full_audio_sample_entry
 {
 	GF_ISOM_AUDIO_SAMPLE_ENTRY
 	//for MPEG4 audio
@@ -1726,18 +1725,16 @@ typedef struct
 	//for FLAC
 	GF_FLACConfigBox *cfg_flac;
 
-} GF_MPEGAudioSampleEntryBox;
-
-/*this is the default visual sdst (to handle unknown media)*/
-typedef struct
-{
-	GF_ISOM_AUDIO_SAMPLE_ENTRY
-	/*box type as specified in the file (not this box's type!!)*/
+	//for generic audio sample entry
+	//box type as specified in the file (not this box's type!!)
 	u32 EntryType;
-	/*opaque description data (ESDS in MP4, ...)*/
+	//opaque description data (ESDS in MP4, ...)
 	u8 *data;
 	u32 data_size;
-} GF_GenericAudioSampleEntryBox;
+
+} GF_MPEGAudioSampleEntryBox;
+
+typedef struct __full_audio_sample_entry GF_GenericAudioSampleEntryBox;
```

This diff merges generic and MPEG-specific sample entry structures, ensuring `data` pointers are managed within a single memory allocation scope. This directly prevents the use-after-free by eliminating dangling pointers from separate generic struct handling.