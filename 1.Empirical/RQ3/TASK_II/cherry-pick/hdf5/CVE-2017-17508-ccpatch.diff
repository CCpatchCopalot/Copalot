diff --git a/src/H5T.c b/src/H5T.c
index fcc4ab3b3e..5aa5c10167 100644
--- a/src/H5T.c
+++ b/src/H5T.c
@@ -5053,6 +5053,8 @@ H5T_set_loc(H5T_t *dt, H5F_t *f, H5T_loc_t loc)
         switch(dt->shared->type) {
             case H5T_ARRAY:  /* Recurse on VL, compound and array base element type */
                 /* Recurse if it's VL, compound, enum or array */
+                                if (0 == old_size)
+                                    HGOTO_ERROR(H5E_DATATYPE, H5E_BADVALUE, FAIL, "old_size of zero would cause division by zero");
                 /* (If the force_conv flag is _not_ set, the type cannot change in size, so don't recurse) */
                 if(dt->shared->parent->shared->force_conv && H5T_IS_COMPLEX(dt->shared->parent->shared->type)) {
                     /* Keep the old base element size for later */
