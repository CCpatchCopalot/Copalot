diff --git a/src/isomedia/box_code_base.c b/src/isomedia/box_code_base.c
index 9a9ad09b4..b45a066cd 100644
--- a/src/isomedia/box_code_base.c
+++ b/src/isomedia/box_code_base.c
@@ -12463,6 +12463,7 @@ GF_Err chnl_box_read(GF_Box *s,GF_BitStream *bs)
 			if (ptr->layout.stream_structure & 2) remain--;
 			ptr->layout.channels_count = 0;
 			while (remain) {
+				if (ptr->layout.channels_count==64) return GF_ISOM_INVALID_FILE;
 				ISOM_DECREASE_SIZE(s, 1)
 				ptr->layout.layouts[ptr->layout.channels_count].position = gf_bs_read_u8(bs);
 				remain--;
diff --git a/src/isomedia/isom_write.c b/src/isomedia/isom_write.c
index 3bddab661..4ac455ddd 100644
--- a/src/isomedia/isom_write.c
+++ b/src/isomedia/isom_write.c
@@ -2479,6 +2479,10 @@ GF_Err gf_isom_set_audio_layout(GF_ISOFile *movie, u32 trackNumber, u32 sampleDe
 	e = CanAccessMovie(movie, GF_ISOM_OPEN_WRITE);
 	if (e) return e;
 
+	if (!layout) return GF_BAD_PARAM;
+	if ((layout->stream_structure & 1) && (layout->definedLayout==0) && (layout->channels_count>=64))
+		return GF_BAD_PARAM;
+
 	trak = gf_isom_get_track_from_file(movie, trackNumber);
 	if (!trak) return GF_BAD_PARAM;
 
