diff --git a/src/regexp.c b/src/regexp.c
index 33b36d11a..3ab479a9c 100644
--- a/src/regexp.c
+++ b/src/regexp.c
@@ -1769,8 +1769,8 @@ regtilde(char_u *source, int magic)
     char_u	*newsub = source;
     char_u	*tmpsub;
     char_u	*p;
-    int		len;
-    int		prevlen;
+    size_t		len;
+    size_t		prevlen;
 
     for (p = newsub; *p; ++p)
     {
@@ -1780,14 +1780,21 @@ regtilde(char_u *source, int magic)
 	    {
 		// length = len(newsub) - 1 + len(prev_sub) + 1
 		prevlen = (int)STRLEN(reg_prev_sub);
-		tmpsub = alloc(STRLEN(newsub) + prevlen);
+		size_t  newsublen = STRLEN(newsub);
+		if (prevlen > MAXCOL || newsublen > MAXCOL
+			|| newsublen + prevlen > MAXCOL)
+		{
+		emsg(_(e_resulting_text_too_long));
+		break;
+		}
+		tmpsub = alloc(newsublen + prevlen);
 		if (tmpsub != NULL)
 		{
 		    // copy prefix
-		    len = (int)(p - newsub);	// not including ~
-		    mch_memmove(tmpsub, newsub, (size_t)len);
+		    len = p - newsub;	// not including ~
+		    mch_memmove(tmpsub, newsub, len);
 		    // interpret tilde
-		    mch_memmove(tmpsub + len, reg_prev_sub, (size_t)prevlen);
+		    mch_memmove(tmpsub + len, reg_prev_sub, prevlen);
 		    // copy postfix
 		    if (!magic)
 			++p;			// back off backslash
