diff --git a/src/option.c b/src/option.c
old mode 100644
new mode 100755
index bb952fee5..b3833bd9c
--- a/src/option.c
+++ b/src/option.c
@@ -3751,6 +3751,11 @@ set_num_option(
     {
 	errmsg = e_argument_must_be_positive;
 	curbuf->b_p_ts = 8;
+    }
+	else if (curbuf->b_p_ts > TABSTOP_MAX)
+    {
+	errmsg = e_invalid_argument;
+	curbuf->b_p_ts = 8;
     }
     if (p_tm < 0)
     {
@@ -6803,9 +6808,7 @@ paste_option_changed(void)
 	    if (buf->b_p_vsts)
 		free_string_option(buf->b_p_vsts);
 	    buf->b_p_vsts = empty_option;
-	    if (buf->b_p_vsts_array)
-		vim_free(buf->b_p_vsts_array);
-	    buf->b_p_vsts_array = 0;
+		VIM_CLEAR(buf->b_p_vsts_array);
 #endif
 	}
 
@@ -6851,7 +6854,6 @@ paste_option_changed(void)
 		free_string_option(buf->b_p_vsts);
 	    buf->b_p_vsts = buf->b_p_vsts_nopaste
 			 ? vim_strsave(buf->b_p_vsts_nopaste) : empty_option;
-	    if (buf->b_p_vsts_array)
 		vim_free(buf->b_p_vsts_array);
 	    if (buf->b_p_vsts && buf->b_p_vsts != empty_option)
 		(void)tabstop_set(buf->b_p_vsts, &buf->b_p_vsts_array);
diff --git a/src/vim.h b/src/vim.h
old mode 100644
new mode 100755
index 15ed6262d..86acb6dcd
--- a/src/vim.h
+++ b/src/vim.h
@@ -2085,6 +2085,8 @@ typedef int sock_T;
 
 #define DICT_MAXNEST 100	// maximum nesting of lists and dicts
 
+#define TABSTOP_MAX 9999
+
 #ifdef FEAT_CLIPBOARD
 
 // VIM_ATOM_NAME is the older Vim-specific selection type for X11.  Still
