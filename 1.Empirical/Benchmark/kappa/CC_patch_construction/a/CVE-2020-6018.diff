diff --git a/src/common/crypto_libsodium.cpp b/src/common/crypto_libsodium.cpp
old mode 100644
new mode 100755
index 7641399..bdd2dcf
--- a/src/common/crypto_libsodium.cpp
+++ b/src/common/crypto_libsodium.cpp
@@ -50,6 +50,13 @@ bool AES_GCM_EncryptContext::Encrypt(
 	void *pEncryptedDataAndTag, uint32 *pcbEncryptedDataAndTag,
 	const void *pAdditionalAuthenticationData, size_t cbAuthenticationData
 ) {
+		// Make sure caller's buffer is big enough to hold the result.
+		if ( cbPlaintextData + crypto_aead_aes256gcm_ABYTES > *pcbEncryptedDataAndTag )
+		{
+			*pcbEncryptedDataAndTag = 0;
+			return false;
+		}
+	
     unsigned long long pcbEncryptedDataAndTag_longlong = *pcbEncryptedDataAndTag;
 
     crypto_aead_aes256gcm_encrypt_afternm(

